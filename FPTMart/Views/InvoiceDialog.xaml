<Window x:Class="FPTMart.Views.InvoiceDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
        Title="HÃ³a ÄÆ¡n" 
        Height="600" Width="400"
        WindowStartupLocation="CenterOwner"
        Background="White">
    
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Invoice Content (to be captured as image) -->
        <Border x:Name="InvoiceContent" Grid.Row="0" Background="White" Padding="20">
            <StackPanel>
                <!-- Header -->
                <StackPanel HorizontalAlignment="Center" Margin="0,0,0,20">
                    <TextBlock Text="ðŸ›’ FPTMart" FontSize="28" FontWeight="Bold" HorizontalAlignment="Center" Foreground="#1976D2"/>
                    <TextBlock Text="Há»‡ Thá»‘ng BÃ¡n HÃ ng" FontSize="12" HorizontalAlignment="Center" Foreground="Gray"/>
                    <TextBlock Text="ÄC: 123 ÄÆ°á»ng ABC, Quáº­n XYZ" FontSize="11" HorizontalAlignment="Center" Foreground="Gray" Margin="0,5,0,0"/>
                    <TextBlock Text="ÄT: 0123.456.789" FontSize="11" HorizontalAlignment="Center" Foreground="Gray"/>
                </StackPanel>

                <!-- Invoice Info -->
                <Border BorderBrush="#E0E0E0" BorderThickness="0,1,0,1" Padding="0,10" Margin="0,0,0,15">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition/>
                            <RowDefinition/>
                            <RowDefinition/>
                        </Grid.RowDefinitions>
                        <TextBlock Grid.Row="0" Text="{Binding InvoiceNumber, StringFormat='HÃ“A ÄÆ N: {0}'}" FontWeight="Bold" FontSize="14"/>
                        <TextBlock Grid.Row="1" Text="{Binding SaleDate, StringFormat='NgÃ y: {0:dd/MM/yyyy HH:mm}'}" Foreground="Gray" FontSize="12"/>
                        <TextBlock Grid.Row="2" Text="{Binding CustomerName, StringFormat='KhÃ¡ch hÃ ng: {0}'}" Foreground="Gray" FontSize="12"
                                   Visibility="{Binding CustomerName, Converter={StaticResource NullToVisibilityConverter}}"/>
                    </Grid>
                </Border>

                <!-- Items -->
                <ItemsControl ItemsSource="{Binding Items}">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <Grid Margin="0,5">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <StackPanel Grid.Column="0">
                                    <TextBlock Text="{Binding ProductName}" FontWeight="Medium"/>
                                    <TextBlock Text="{Binding Quantity, StringFormat='{}{0} x '}" Foreground="Gray" FontSize="11">
                                        <Run Text="{Binding UnitPrice, StringFormat='{}{0:N0}Ä‘'}"/>
                                    </TextBlock>
                                </StackPanel>
                                <TextBlock Grid.Column="1" 
                                           Text="{Binding TotalPrice, StringFormat='{}{0:N0} Ä‘'}" 
                                           VerticalAlignment="Center"
                                           FontWeight="Medium"/>
                            </Grid>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>

                <!-- Totals -->
                <Border BorderBrush="#E0E0E0" BorderThickness="0,1,0,0" Padding="0,15,0,0" Margin="0,15,0,0">
                    <StackPanel>
                        <Grid>
                            <TextBlock Text="Táº¡m tÃ­nh:"/>
                            <TextBlock Text="{Binding SubTotal, StringFormat='{}{0:N0} Ä‘'}" HorizontalAlignment="Right"/>
                        </Grid>
                        <Grid Margin="0,5,0,0" Visibility="{Binding HasDiscount, Converter={StaticResource BooleanToVisibilityConverter}}">
                            <TextBlock Text="Giáº£m giÃ¡:"/>
                            <TextBlock Text="{Binding DiscountAmount, StringFormat='-{0:N0} Ä‘'}" HorizontalAlignment="Right" Foreground="#F44336"/>
                        </Grid>
                        <Grid Margin="0,10,0,0">
                            <TextBlock Text="Tá»”NG Cá»˜NG:" FontWeight="Bold" FontSize="16"/>
                            <TextBlock Text="{Binding TotalAmount, StringFormat='{}{0:N0} Ä‘'}" 
                                       HorizontalAlignment="Right" 
                                       FontWeight="Bold" 
                                       FontSize="18" 
                                       Foreground="#388E3C"/>
                        </Grid>
                        <Grid Margin="0,5,0,0">
                            <TextBlock Text="Tiá»n khÃ¡ch Ä‘Æ°a:"/>
                            <TextBlock Text="{Binding PaidAmount, StringFormat='{}{0:N0} Ä‘'}" HorizontalAlignment="Right"/>
                        </Grid>
                        <Grid Margin="0,5,0,0">
                            <TextBlock Text="Tiá»n thá»«a:" FontWeight="Medium"/>
                            <TextBlock Text="{Binding ChangeAmount, StringFormat='{}{0:N0} Ä‘'}" 
                                       HorizontalAlignment="Right" 
                                       FontWeight="Medium" 
                                       Foreground="#1976D2"/>
                        </Grid>
                    </StackPanel>
                </Border>

                <!-- Footer -->
                <StackPanel HorizontalAlignment="Center" Margin="0,20,0,0">
                    <TextBlock Text="â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”" HorizontalAlignment="Center" Foreground="Gray"/>
                    <TextBlock Text="Cáº£m Æ¡n quÃ½ khÃ¡ch!" FontWeight="Medium" HorizontalAlignment="Center" Margin="0,10,0,0"/>
                    <TextBlock Text="Háº¹n gáº·p láº¡i!" FontSize="11" HorizontalAlignment="Center" Foreground="Gray"/>
                </StackPanel>
            </StackPanel>
        </Border>

        <!-- Buttons -->
        <Grid Grid.Row="1" Margin="20">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>
            
            <Button Grid.Column="0" 
                    Content="ðŸ’¾ LÆ°u áº¢nh"
                    Click="SaveImage_Click"
                    Style="{StaticResource MaterialDesignRaisedButton}"
                    Background="#1976D2"
                    Height="40"
                    Margin="0,0,10,0"/>
            
            <Button Grid.Column="1" 
                    Content="ÄÃ³ng"
                    Click="Close_Click"
                    Style="{StaticResource MaterialDesignOutlinedButton}"
                    Height="40"/>
        </Grid>
    </Grid>
</Window>
